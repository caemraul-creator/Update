<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Detail Barang</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --radius:12px;
      --shadow:0 4px 6px -1px rgb(0 0 0 / 0.1);
    }
    body{
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      background:#e5e7eb;
      min-height:100vh;
      padding:1rem;
    }
    .container-wrapper{
      max-width:850px;
      margin:0 auto;
    }
    .card-glass{
      background:#ffffff;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      border:none;
      padding:1.5rem;
    }
    .page-title{
      font-size:1.6rem;
      font-weight:700;
      margin-bottom:0.25rem;
    }
    .page-subtitle{
      font-size:.95rem;
      color:#6b7280;
      margin:0;
    }
    .img-main{
      max-height:340px;
      object-fit:contain;
      width:100%;
      border-radius:8px;
      background:#f3f4f6;
      padding:8px;
    }

    /* TABEL DETAIL – TIDAK WRAP & BISA DI-SCROLL SAMPING */
    .detail-table-wrapper{
      width:100%;
      overflow-x:auto;          /* kalau kepanjangan bisa geser kanan */
    }
    .detail-table{
      width:100%;
      border-collapse:collapse;
      font-size:.95rem;
      min-width:320px;          /* biar tidak terlalu sempit di HP */
    }
    .detail-table th,
    .detail-table td{
      padding:6px 0;
      vertical-align:top;
      white-space:nowrap;       /* cegah teks turun ke bawah */
    }
    .detail-table th{
      font-weight:600;
      width:150px;              /* lebar kolom kiri */
      padding-right:12px;
    }
    .detail-table tr + tr td,
    .detail-table tr + tr th{
      border-top:1px solid #e5e7eb;
    }

    @media (max-width:576px){
      .page-title{
        font-size:1.3rem;
      }
    }
  </style>
</head>
<body>

<div class="container-wrapper">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h2 class="page-title" id="judulBarang">Detail Barang</h2>
      <p class="page-subtitle" id="subJudul">Memuat data...</p>
    </div>
    <a href="javascript:history.back()" class="btn btn-outline-secondary btn-sm">
      <i class="bi bi-arrow-left"></i> Kembali
    </a>
  </div>

  <!-- FOTO DI ATAS -->
  <div class="card-glass mb-3 text-center">
    <img id="fotoBarang" class="img-main d-none" alt="Foto Barang">
    <div id="fotoKosong" class="text-muted py-4">
      <i class="bi bi-image mb-1" style="font-size:2rem;"></i>
      <div>Tidak ada foto</div>
    </div>
    <small class="text-muted">
      Ketuk gambar untuk membuka ukuran penuh
    </small>
  </div>

  <!-- DETAIL BARANG -->
  <div class="card-glass">
    <div class="detail-table-wrapper">
      <table class="detail-table">
        <tbody id="detailBody"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Script -->
<script>
var GAS_URL = 'https://script.google.com/macros/s/AKfycbybPJC9cma13VPdf0ttElGc_CMe5-C-26pTsAkaMfctHcVuKrK1mdVYQcb7sbWcNtgf/exec';

/* API PUBLIC – TANPA TOKEN */
function apiPublic(action, params){
  if(!params) params = {};
  var body = new URLSearchParams({ action: action });
  Object.keys(params).forEach(function(k){
    body.append(k, params[k]);
  });
  return fetch(GAS_URL,{method:'POST',body:body})
    .then(function(r){ return r.json(); })
    .then(function(res){
      if(!res.success) throw new Error(res.error || 'Terjadi kesalahan');
      return res.data;
    });
}

function formatDateDisplay(iso){
  if(!iso) return '';
  var d = new Date(iso);
  if(isNaN(d)) return iso;
  var dd = String(d.getDate()).padStart(2,'0');
  var mm = String(d.getMonth()+1).padStart(2,'0');
  var yyyy = d.getFullYear();
  return dd + '/' + mm + '/' + yyyy;
}

function loadDetail(){
  var params = new URLSearchParams(window.location.search);
  var id = params.get('id');
  if(!id){
    alert('ID barang tidak ditemukan di URL');
    return;
  }

  document.getElementById('subJudul').textContent = 'ID: ' + id;

  // pakai endpoint public (tanpa login)
  apiPublic('getBarangByIdPublic', { id: id })
    .then(function(b){
      document.getElementById('judulBarang').textContent = b.nama || 'Detail Barang';
      document.getElementById('subJudul').textContent = 'ID: ' + (b.id || id);

      // FOTO
      var img   = document.getElementById('fotoBarang');
      var kosong= document.getElementById('fotoKosong');

      if (b.foto && String(b.foto).trim() !== '') {
        var urlFoto = String(b.foto).trim();
        img.src = urlFoto;
        img.classList.remove('d-none');
        kosong.classList.add('d-none');
        img.onclick = function(){ window.open(urlFoto,'_blank'); };
      } else {
        img.src = '';
        img.classList.add('d-none');
        kosong.classList.remove('d-none');
        img.onclick = null;
      }

      // DETAIL TABEL
      var jumlahText = (b.jumlah !== undefined && b.jumlah !== null && b.jumlah !== '')
        ? b.jumlah
        : 1;
      var satuanText = b.satuan ? b.satuan : '';

      var html = '';
      html += '<tr><th>Nama Barang</th><td>' + (b.nama || '-') + '</td></tr>';
      html += '<tr><th>Kategori</th><td>' + (b.kategori || '-') + '</td></tr>';
      html += '<tr><th>Merk/Model</th><td>' + (b.merk || '-') + '</td></tr>';
      html += '<tr><th>Jumlah</th><td>' + jumlahText + ' ' + satuanText + '</td></tr>';
      html += '<tr><th>Gedung</th><td>' + (b.gedungNama || b.gedung || '-') + '</td></tr>';
      html += '<tr><th>Ruangan</th><td>' + (b.ruangan || '-') + '</td></tr>';
      html += '<tr><th>Tanggal Masuk</th><td>' + formatDateDisplay(b.tglMasuk) + '</td></tr>';
      html += '<tr><th>Status</th><td>' + (b.status || '-') + '</td></tr>';
      html += '<tr><th>Deskripsi</th><td>' + (b.deskripsi || '-') + '</td></tr>';

      document.getElementById('detailBody').innerHTML = html;
    })
    .catch(function(err){
      console.error(err);
      alert('Gagal memuat detail barang: ' + err.message);
    });
}

window.onload = loadDetail;
</script>

</body>
</html>
